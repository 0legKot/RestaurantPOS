@model Table
@{
    ViewData["Title"] = "TableDetail";
    var curSeat = Model.TableSeats[ViewBag.curSeat];
    var isOpened = curSeat.Order == null ? false : curSeat.Order.State != Order.OrderState.Voided && curSeat.Order.State != Order.OrderState.Paid;
}

<style>
    #rot180 {
        -webkit-transform: rotate(180deg);
        -moz-transform: rotate(180deg);
        -ms-transform: rotate(180deg);
        -o-transform: rotate(180deg);
        transform: rotate(180deg);
    }

    div.tabl {
        max-width: 200px;
        min-width: 100px;
    }
</style>
<h2>TableDetail</h2>
<h3>@Model.Id</h3>
<h3>Table row: @Model.Row</h3>
<h3>Table column: @Model.Column</h3>
<h3>Seat: @ViewBag.curSeat</h3>
<div class="tabl">
    @await Html.PartialAsync("_TableItem", @Model)
</div>
<p>Id of seat: @curSeat.Id</p>
@if (curSeat.Order == null)
{
    @await Html.PartialAsync("_OrderCreation")

}
else
{
    <h3>Order status: @curSeat.Order.State</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <td>Item name</td>
                <td>Item price</td>
            </tr>
        </thead>
        @foreach (OrderItem item in curSeat.Order.OrderItems)
        {
            <tr>
                <td> @item.Name </td>
                <td> @item.Price </td>
            </tr>
        }
    </table>
    @if (isOpened)
    {
        <p>Add item:</p>
        @await Html.PartialAsync("_ItemAdding")
        <p>Select additional seats:</p>

            @foreach (TableSeat ts in Model.TableSeats)
    {
        if (ts != curSeat&&ts.Order==null)
        {

        <form method="post" action="/AddSeats" class="form-group">
            <input type="hidden" value="@ViewBag.row" name="row" />
            <input type="hidden" value="@ViewBag.column" name="column" />
            <input type="hidden" value="@ViewBag.curSeat" name="seat" />
            <input type="hidden" value="@Array.IndexOf(Model.TableSeats, ts)" name="additionalSeat" />
            <input type="submit" value="Add seat number @Array.IndexOf(Model.TableSeats, ts)" />

        </form>
}

        }
    }
    <p>Discount:@curSeat.Order.Discount </p>
    @if (isOpened)
    {
        @await Html.PartialAsync("_IncreaseDiscount")
    }
    <p>Tips:@curSeat.Order.Tips</p>
    @if (isOpened)
    {
        @await Html.PartialAsync("_IncreaseTips")
    }
    <p>Total:@curSeat.Order.TotalPrice</p>
    @if (isOpened)
    {
        @await Html.PartialAsync("_OrderActions")
    }
}
